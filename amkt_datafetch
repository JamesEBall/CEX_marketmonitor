from distutils.log import error
from open_crypto import runner
from matplotlib import pyplot as plt
import sqlite3 
import pandas as pd

#deselect this during testing

#runner.update_maps() # download the lastest exchanges mappings from the GitHub repository

def check_dbstatus():
    if con.total_changes == 0:
        return(print("DB connection established"))
    else:
        return(print("failed to establish connection to database"))

#AMKT.yaml default config - edit sources and data types here
#host: localhost
#port: 5432


#fetch orderbook data
def __main__():
    #fetch data from exchanges
    runner.run('amkt.yaml')
    # Read sqlite query results into a pandas DataFrame
    
    con = sqlite3.connect("amkt_data.db")
    
    check_dbstatus()

    df = pd.read_sql_query('SELECT * FROM order_books_view;', con)

    # Verify that result of SQL query is stored in the dataframe

    con.close()

    return df


